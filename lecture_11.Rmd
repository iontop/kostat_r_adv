---
title: "Lecture #11"
subtitle: "이산형 난수 발생과 표본 선택"
author: "Junho Ahn"
date: "`r format(Sys.Date(), '%Y-%m-%d')`"
output: 
  html_document:
    theme: paper
    highlight: textmate
    df_print: paged
    toc: true
    toc_depth: 3
    toc_float: true
    fig_caption: true
---

```{r setup, include=FALSE}
graphics.off()
rm(list = ls())
gc()

options(kableExtra.auto_format = FALSE)

# knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE,
knitr::opts_chunk$set(echo = TRUE, message = TRUE, warning = TRUE,
                      fig.align = "center", fig.width = 7, fig.retina = 2,
                      dpi = 96)

#theme_set(theme_bw())

```

## 난수의 발생

### sample과 sample.int 함수

**출력**  
유한 모집단에 필요한 개수의 난수를 뽑는 함수  
  
**성질**
유한모집단이지만 복원추출(하나를 뽑고 다시 원상복귀 후 다음 뽑기)인 경우 무한 모집단과 같음  
  
**매개변수**  
- x: 추출할 원소를 포함한 벡터를 주거나 자연수 값을 줄 수 있음. 벡터가 주어지면 주어진 벡터의 원소에서 표본을 추출하고, 자연수 값을 주면 1부터 x사이의 자연수에서 표본을 추출함  
- n: 자연수 값을 지정하며, 1부터 n사이의 자연수에서 표본을 추출함  
- size: 자연수를 지정하며 추출할 표본의 크기임  
- replace: 논리값(TRUE or FALSE)을 설정하며, TRUE면 복원추출, FALSE면 비복원 추출을 함 (Default: FALSE)  
- prob: x의 원소 또는 1에서 n사이의 값이 관찰될 확률을 설정함. 이 값이 설정되지 않으면 확률은 1/length(x) 및 1/n 으로 등확률임.  

<br>

### 이산형 난수의 발생  

**예제1**  
(표본설계) 어느 자치구에는 12개의 동이 있다. 조사를 위해서 이 중에서 4개의 동을 임의로 선택하는 방법  

```{r}
x <- seq(1,12)
sample(x, size = 4)
```

또는 

```{r}
sample.int(12, size = 4)
```

<br>

**예제2**  
(표본설계에 적용) 뽑힌 4개의 동에는 각각 19세 이상의 주민의 수가 12,000명, 7,000명, 5,000명 및 3,000명의 주민이 있다고 한다. 각 동에서 비례할당의 방법으로 1%의 주민을 조사대상으로 뽑으려면 어떻게 해야 하는가?  

(2-1) 뽑힌 번호에 해당하는 사람을 선택하기  

```{r}
sample.int(12000, size = 120)
sample.int(7000, size = 70)
sample.int(5000, size = 50)
sample.int(3000, size = 30)
```

(2-2) 번호를 순서대로 나오게 하기 위해 `sort()`함수 사용하기  

```{r}
sort(sample.int(12000, size = 120))
sort(sample.int(7000, size = 70))
sort(sample.int(5000, size = 50))
sort(sample.int(3000, size = 30))
```

<br>

**예제3**  
(등확률이 아닌 경우) 다음은 A, B, C, D가 관찰될 확률이 각각 0.1, 0.2, 0.3 및 0.4인 모집단에서 10개를 복원 추출로 뽑는 경우를 모의 실험하는 과정이다.  

```{r}
x <- c("A", "B", "C", "D") # 모든 가능한 값을 포함한 벡터 설정
p <- c(0.1, 0.2, 0.3, 0.4) # 각 값에 대응하는 확률
sample(x, size = 10, replace = TRUE, prob = p) # 복원추출 10회
```

(복원추출) 위의 예제에서 난수 1000개를 발생시켜 도수분포표와 막대그래프를 그려본다.  

```{r}
x <- c("A", "B", "C", "D") # 모든 가능한 값을 포함한 벡터 설정
p <- c(0.1, 0.2, 0.3, 0.4) # 각 값에 대응하는 확률
data <- sample(x, size = 1000, replace = TRUE, prob = p) # 복원추출 1000회

table(data)
```

```{r}
barplot(table(data))
```

A, B, C, D 각각의 확률이 0.1, 0.2, 0.3, 0.4의 확률로 관찰됨을 확인할 수 있음.  

<br>

**예제4**  
(동전 모의실험) 공평한 동전을 1000번 던져서 나오는 앞면의 수를 위의 `sample()`또는 `sample.int()` 함수를 사용하여 찾는다.  

```{r}
table(sample(c("H","T"), 1000, replace = TRUE, prob=c(0.5, 0.5)))
```

<br>

## 이항분포
베르누이 시행을 n번 반복했을 때 k번 성공할 확률  
예) 추신수 선수가 오늘 경기에서 5번 타석에 들어와서 3번 안타를 칠 확률

### 이항분포의 성질  

각각의 시행에서 성공확률이 $p$이고 실패확률이 $(1-p)$인 시행을 $n$번 독립적으로 시행할 때 성공의 횟수를 확률변수 $X$라고 하면 $X$의 분포를 이항분포라고 함.  

$B(n,p)$로 표시하기도 함.  

$X$가 이항분포인 경우 확률밀도함수  

$$Pr[X=x]=\begin{pmatrix} n \\ x \end{pmatrix} \quad p^x(1-p)^{n-x} \quad \quad x = 0,1,2,3,...,n$$

성공할 확률 $p$가 0이나 1에 가깝지 않고 $n$이 충분히 크면 이항분포는 정규분포에 가까워진다. 성공할 확률 $p$가 1/2에 가까우면 종모양이 된다.  

<br>

### 이항분포 난수발생과 확률계산

이항분포의 확률값(`dbinom()`), 누적확률값(`pbinom()`), 분위수(`qbinom()`), 난수(`rbinom()`)을 구하기 위한 함수  

**관련함수의 매개변수**  
- x, q: 확률밀도함수값을 얻을 x벡터, 누적확률을 얻을 분위수 q벡터  
- p: 분위수를 얻을 확률값의 벡터  
- n: 발생할 난수의 개수  
- lower.tail: 논리값을 설정하며 TRUE이면 확률은 $P[X \leq x]$의 값으로 그렇지 않으면 $P[X \gt x]$을 계산  
- size: 이항분포 $B(n,p)$에서 $n$값을 설정  
- prob: 이항분포 $B(n,p)$에서 $p$값을 설정  


### 난수발생과 확률계산 함수 이름의 규칙

- R은 다양한 분포에 대해서 난수발생, 확률밀도함수값, 누적확률함수값, 분위수 계산을 할 수 있는 함수를 제공  
- 함수가 가진 규칙  
  1. r ~ : 분포의 이름이 ~인 분포에서 난수를 발생하는 함수, r을 접두어로 사용  
  2. d ~ : 분포의 이름이 ~인 분포에서 확률밀도함수값을 발생하는 함수, d를 접두어로 사용  
  3. p ~ : 분포의 이름이 ~인 분포에서 누적확률함수 $F(x) = Pr[X \leq x]$를 계산, p를 접두어로 사용  
  4. q ~ : 분포의 이름이 ~인 분포에서 분위수를 계산, q를 접두어로 사용  
  
- 이항분포의 경우 분포 이름으로 binom을 사용하고 각각 접두어에 r, d, p, q를 사용하였음을 알 수 있음.  

<br>

### 이항분포 난수 발생과 확률계산 - 예제

X가 이항분포 $B(10, 0.2)$ (= 10번 시도하면 0.2번 성공하는 일) 경우 확률밀도함수 값은 아래와 같다. 

```{r}
y <- dbinom(0:10, 10, 0.2)
par(family = "AppleGothic")
plot(0:10, y, type = 'h', col = 'gray20', ylab = "Probability", xlab="확률변수 X",
     main="X ~ B(10, 0.2)")
```


예제1. 10번 시도하여 2번 성공할 확률  

```{r}
dbinom(2, 10, 0.2) #B(10, 0.2), Pr[X = 2]
```

<br>

예제2. 10번 시도하여 2번 성공할 확률의 누적확률 (0번, 1번, 2번이 될 확률의 누적)  

```{r}
pbinom(2, 10, 0.2) #B(10, 0.2), Pr[X =< 2]
```

위 `pbinom(2, 10, 0.2)`결과는 아래와 같은 의미임  

```{r}
dbinom(0, 10, 0.2) + dbinom(1, 10, 0.2) + dbinom(2, 10, 0.2) 
```

<br>

예제3. 10번 시도하여 2번 초과하여 성공할 확률 (3번 ~ 10번)   

```{r}
1-pbinom(2, 10, 0.2) #B(10, 0.2), Pr[X > 2]
```

lower.tail 옵션을 FLASE로 설정하여 동일한 효과를 얻을 수 있음.  

```{r}
pbinom(2, 10, 0.2, lower.tail = FALSE)
```

<br>

예제4. 10번 시도하여 성공할 누적확률이 0.5가 되는 확률변수 (이산확률변수이기 때문에 누적확률이 0.5보다 크면서 가장 가까운 확률변수를 반환)  

```{r}
qbinom(0.5, 10, 0.2)
```

<br>

예제5. (동전모의실험) 이항분포는 성공확률이 $p$인 실험을 독립적으로 $n$번 시행할 때 성공의 횟수에 대한 분포이므로 앞면의 갯수는 이항분포 $B(1000, 0.5)$를 따른다. 1000번의 동전던지기에서 앞면의 갯수를 5회에 걸쳐 모의실험해보자.  

```{r}
rbinom(1, 1000, 0.5)
rbinom(1, 1000, 0.5)
rbinom(1, 1000, 0.5)
rbinom(1, 1000, 0.5)
rbinom(1, 1000, 0.5)
```

<br>

예제6. (주사위 던지기) 주사위를 던지면 1이 나올 확률이 1/6이다. 주사위를 다섯번 던질 때 1의 눈금이 나올 횟수를 확률변수 $X$라고 하면 $X$의 분포는 $B(5, 1/6)$이며 $X$의 기댓값과 분산은 각각 $E[X]=np=5/6=0.8333, \quad Var(X)=npq=25/36=0.6944$이다.   
주사위를 다섯번 던지는 실험을 100번 반복할 때 1의 눈금이 나온 횟수의 평균과 분산이 계산값과 얼마나 가까운지 모의실험을 해보자.  

```{r}
binom.par <- function(nrep=100, n=5, p=1/6) {
  x <- rbinom(nrep, n, p) #B(n,p)에서 nrep개의 난수 생성
  meanx <- mean(x) #생성된 난수들의 평균
  varx <- var(x) #난수의 분산
  list(meanx = meanx, varx = varx)
}

binom.par() #결과는 random하게 바뀜
```

<br>

## 초기하분포

### 초기하분포의 성질

초기하분포(hypergeometric distribution)은 m개의 빨간공과 n개의 흰공이 들어가 있는 주머니에서 k개를 비복원으로 뽑을 때 빨간공의 개수의 분포를 뜻한다.  

`~hyper()`를 사용하여 구할 수 있다.  

<br>

### 난수발생과 확률계산  

예제1. (로또확률) 로또는 45개 중에서 6개의 번호를 골라 이 중에서 당첨번호와 일치하는 갯수에 따라 등수가 정해진다. 6개 중 3개 이상이 맞으면 당첨금을 받을 수 있다.  
이 때 당첨번호와 일치하는 번호의 갯수를 $X$라 하면 일치하는 번호의 갯수가 $x$일 확률은  

$$Pr[X=x] = \frac{\begin{pmatrix} 6 \\ x \end{pmatrix}\begin{pmatrix} 6 \\ 6-x \end{pmatrix}}{\begin{pmatrix} 45 \\ 6 \end{pmatrix}}, \quad x = 0,1,2,...,6$$

$x$가 6이면(1등)이 될 확률은 1/8,145,060=0.000000127738이다. 이를 R에서 계산해보자.  

로또의 경우 6개의 당첨번호(빨간공)와 나머지 39개의 비당첨번호(흰공)로 45개의 공이 들어가 있는 주머니에서 6개를 뽑는 경우로 m=6, n=39, k=6인 경우임.  

`dhyper()`함수로 확률 계산하기 $\rightarrow$ 로또에서 0~6개의 번호를 맞출 확률을 출력해 줌    

```{r}
dhyper(0:6, 6, 39, 6)
```

6개를 다 맞출 확률은 

```{r}
dhyper(6, 6, 39, 6)
```

<br>

예제2. 로또에서 3개 이상의 번호를 맞출 확률을 계산해 보자  

```{r}
1-phyper(2, 6, 39, 6)
```

<br>

## 동일한 난수 생성하기  

### set.seed 함수  

한 번 발생한 난수를 그대로 발생하고자 하는 경우 동일한 난수를 얻게 설정하는 함수  

**중요!!!** 이 함수는 자주 사용됨.   

`set.seed()` 함수를 사용하고 사용자가 임의로 정한 값을 입력하면 됨.  

### 동일한 난수 생성: `set.seed()`함수

set.seed 설정 전  

```{r}
rbinom(10, 100, 0.5)
```

```{r}
rbinom(10, 100, 0.5)
```

```{r}
rbinom(10, 100, 0.5)
```

난수를 생성할 때마다 다른 값이 생성됨.

set.seed 설정 후

```{r}
set.seed(1234)
rbinom(10, 100, 0.5)
```

```{r}
set.seed(1234)
rbinom(10, 100, 0.5)
```

```{r}
set.seed(1234)
rbinom(10, 100, 0.5)
```

`set.seed()`값을 동일하게 주면 동일한 난수가 생성됨.  


